function findFacebookObj(a){var c=1;for(a=TMExt_$(a).parent();!a.hasClass("userContentWrapper")&&10>c;)c++,a=a.parent();return a.hasClass("userContentWrapper")?a:null}function findTwitterObj(a){var c=1;for(a=TMExt_$(a).parent();!a.hasClass("tweet")&&!a.hasClass("ProfileTweet")&&10>c;)c++,a=a.parent();return a.hasClass("tweet")||a.hasClass("ProfileTweet")?a:null}
function TSNSFeedbackUnsafeURL(a){if(IsInSNSandRequiredForThisLevel(a))try{if(/twitter\.com/.test(document.location)){PSDebug.log("in TSNSFeedbackUnsafeURL");var c=a.FindInsertNode(),b=findTwitterObj(c);if(b){var e,q,r,g;if(b.hasClass("tweet"))e=b.find("._timestamp").attr("data-time"),g=b.find(".tweet-text");else if(b.hasClass("ProfileTweet"))e=b.find(".js-short-timestamp").attr("data-time"),g=b.find(".ProfileTweet-text");else return;q=g.attr("lang");r=g.text().trim().replace(new RegExp(String.fromCharCode(160),
"gi"),"");var k=b.attr("data-tweet-id"),s=b.attr("data-screen-name"),t=b.attr("data-user-id"),u=!!b.attr("data-has-cards")+"",v=b.attr("data-you-follow"),w=b.attr("data-you-block"),x=b.attr("data-retweet-id"),y=b.attr("data-retweeter"),z=b.find(".js-retweet-text a.js-user-profile-link").attr("data-user-id"),A=b.attr("data-mentions")||"",B=TMExt_$(c).attr("data-expanded-url"),C=!!b.attr("data-protected")+"",l,m=g.find("a[data-query-source='hashtag_click'] b");if(m.length)for(l=[],c=0;c<m.length;c++)l.push(TMExt_$(m[c]).text());
var n=a.level,p=a.link;PSDebug.log("check data-tweet-id:",k);k&&(PSDebug.log("do feedback "),SendMailtoPlugToolbar(JSON.stringify({params:{actionID:20001,paramsIn:{webSite:"twitter",url:[p],urlLevel:[n],dataTweetId:k,dataScreenName:s,dataUserID:t,dataHasCards:u,dataYouFollow:v,dataYouBlock:w,dataMentions:A.split(" "),dataReScreenName:y,dataReTweetId:x,dataReTweeterUserId:z,dateTime:e,lang:q,text:r,dataExpendUrl:[B],hashTag:l,dataProtect:C}}})))}}else if(/facebook\.com/.test(document.location)){var c=
a.FindInsertNode(),d=findFacebookObj(c);if(d){var h=d.find("a[data-hover='tooltip']:eq(0)").attr("aria-label"),D=d.find("h5 a:eq(0),h6 a:eq(0)").text(),E=d.find("h5 a:eq(0),h6 a:eq(0)").attr("href"),F=d.find("h5 a:eq(1),h6 a:eq(1)").text()||d.find(".userContent .userContentSecondary a").text();e=d.find("abbr").attr("data-utime");var G=d.find(".userContent").text();if("\u516c\u958b"==h||"\u516c\u5f00"==h||"public"==h||"Public"==h)n=a.level,p=a.link,e&&(PSDebug.log("do feedback "),SendMailtoPlugToolbar(JSON.stringify({params:{actionID:20001,
paramsIn:{webSite:"facebook",url:[p],accountName:D,accountLink:E,accessPrivilege:h,dateTime:e,userContent:G,urlLevel:[n],place:F}}})))}}}catch(f){f.number&&f.description?(a="catch err:[\n"+("Facility Code: "+(f.number>>16&8191)+"\n"),a+="Number: "+(f.number&65535)+"\n",a+="Description: "+f.description+"\n",TMExt_debug(a)):TMExt_debug(f)}}
function IsInSNSandRequiredForThisLevel(a){if(3!=a.level&&5!=a.level&&7!=a.level&&8!=a.level)return!1;a=!1;try{if(/facebook\.com/.test(document.location)||/twitter\.com/.test(document.location))a=!0}catch(c){TMExt_debug(c)}return a};
