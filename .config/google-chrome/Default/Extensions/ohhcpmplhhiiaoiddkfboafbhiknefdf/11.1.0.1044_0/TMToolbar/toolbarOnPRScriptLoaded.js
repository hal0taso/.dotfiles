(function(){var b=window;tbc_sendRequest(TB_ACTIONS.CAN_RATING,{},function(g){b.ContentPageCacheSettings=g;tbc_sendRequest(TB_ACTIONS.PRELOAD,{url:document.location},function(c){tbc_log("preload ok");var e=CreatePageRatingHandler(c);e&&(c=e.getScripts(),c.push(getLocaleResource("_locales","TISProToolbarLocalization.js")),c.push(TB_PATHS.JS_CRENGINE_RES_DEFINE),c={scripts:c,csses:["TMToolbar/common_resource/TISProToolbar.css",getLocaleResource("_locales","css/TISProToolbar_l10n.css")],all_frames:!1},
tbc_sendRequest(TB_ACTIONS.INJECTRESOURCES,c,function(){(function(){function a(a){var d=document.getElementById(a);d||(d=document.createElement("div"),d.id=a,d.innerHTML="init",d.style.display="None",document.documentElement.appendChild(d));return d}document.getElementById("tmtoolbar_injected")||(document.getElementById(TAG_ID4TOOLBAR_GUID)||(a(TAG_ID4TOOLBAR_GUID).innerText=GenerateGuid()),a("tmtoolbar_message").addEventListener("eventBeginRating",function(){var f=a(TAG_ID4TOOLBAR_GUID).innerText;
tbc_log("==>onEventBeginRating,guid="+f);var d=JSON.parse(a("tmtoolbar_message").innerText);portToBackground=chrome.extension.connect({name:f});portToBackground.onMessage.addListener(function(a){a=a.params;"undefined"!=!typeof TSRGetRatingFlowID&&a.flowID==TSRGetRatingFlowID()||tbc_log("flowID is invalid");tbc_log("insert rating result,url="+a.url);TSRInsertResultICON&&TSRInsertResultICON(a.resultID,a.ratingLevel,a.bPhishing)});var b=function(a,c){setTimeout(function(){tbc_log("before parse");b.funParse=
(new TFunctionParse(document)).trycall(d);document.documentElement.addEventListener(EVENT_DOM_SUBTREE_MODIFIED,c)},a)},c=function(){tbc_log("==>dom updated");document.documentElement.removeEventListener(EVENT_DOM_SUBTREE_MODIFIED,c);b(1E3,c);tbc_log("<==dom updated")};b(0,c)}),a("tmtoolbar_injected"))})();e.parseIFrames("",function(a,b){tbc_log("parseIFrames callback");if(b.getElementById("tmtoolbar_injected")){if(tbc_log("found tmtoolbar_injected"),!b.getElementById(TAG_ID4TOOLBAR_PARSE)){tbc_log("==>first time insert parse node");
var d=b.createElement("div");d.id=TAG_ID4TOOLBAR_PARSE;b.documentElement.appendChild(d);tbc_log("==>fFireEvent");d=b.createEvent("Event");d.initEvent("eventBeginRating",!0,!0);var c=b.getElementById("tmtoolbar_message");c.innerText=JSON.stringify(a);c.dispatchEvent(d);tbc_log("<==fFireEvent")}}else tbc_log("Error: not found tmtoolbar_injected, may need to inject again")})}),"undefined"===typeof b.Feedback2SiteSafety&&(b.Feedback2SiteSafety=function(a){tbc_sendRequest(TB_ACTIONS.FEEDBACK_2_SITESAFETY,
{params:a},function(){})}),"undefined"===typeof b.SetTempImageSafeSearchStatus&&(b.SetTempImageSafeSearchStatus=function(a){b.SetTempImageSafeSearchStatus.currentTab=!0;tbc_sendRequest(TB_ACTIONS.SET_TEMP_IMAGE_SAFE_SEARCH,{},function(){});b.RefreshPageCallback=a},chrome.runtime.onMessage.addListener(function(a,c,d){a.action==TB_ACTIONS.FORCE_REFRESH_PAGE&&a.ForceRefresh&&!0==b.SetTempImageSafeSearchStatus.currentTab&&(window.RefreshPageCallback(),b.SetTempImageSafeSearchStatus.currentTab=!1)})))})})})();
